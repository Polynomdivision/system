- hosts: 127.0.0.1
  connection: local
  vars:
    username: 'alexander'
  roles:
    - { role: setup, user: '{{ username }}', hostname: 'isla-vm{{ vm_number }}', password_hash: '{{ hash }}' }
    - { role: system_vm, user: '{{ username }}'}
  tasks:
    - block:
      - name: Set the owner of the home directory to the user
        command: chown -R '{{ username }}' '/home/{{ username }}'
      - name: Change files marked executable to 700
        command: find '/home/{{ username }}' -type f -executable -exec chmod 700 {} +
      - name: Change files not marked as executable to 600
        command: find '/home/{{ username }}' -type f -not -executable -exec chmod 600 {} +
      - name: Change all directories to 700
        command: find '/home/{{ username }}' -type d -exec chmod 700 {} +
